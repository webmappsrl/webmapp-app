<ng-container *ngIf="waypoint$|async as waypoint">
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-back-button
          mode="ios"
          defaultHref="map"
          text=""
          class="webmapp-backbutton webmapp-backbutton-dark"
        ></ion-back-button>
      </ion-buttons>
      <ion-title>{{'pages.waypointdetail.title'|wmtrans}}</ion-title>
      <ion-buttons slot="end">
        <wm-export-to-btn
          [to]="'json'"
          [input]="waypoint"
          [saveFileFn]="saveFileCallback"
        ></wm-export-to-btn>
        <ion-button (click)="delete()" *ngIf="online$|async">
          <ion-icon name="trash-outline" start></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content id="main">
    <wm-map
      class="wm-waypointdetail-map"
      [wmMapConf]="confMap$|async"
      [wmMapFullscreen]="true"
      [wmMapGeojson]="waypoint"
      [wmMapGeojsonFit]="true"
    ></wm-map>

    <ng-container *ngIf="waypoint.properties as prop">
      <ng-container *ngIf="prop.rawData as rawData">
        <ion-list class="wm-waypointdetail-itemlist" lines="none">
          <wm-form [confPOIFORMS]="confPOIFORMS$|async" [init]="waypoint" [disabled]="true">
            <div header class="wm-waypointdetail-date">
              {{prop.created_at | date : "dd MMMM YYYY"}}
            </div>
            <ion-item
              class="wm-waypointdetail-item"
              lines="none"
              *ngIf="rawData.nominatim as nominatim"
              header
            >
              <i class="webmapp-icon-pin-outline wm-waypointdetail-icon secondary" start></i>
              <div>
                <div
                  class="wm-waypointdetail-item-city"
                  *ngIf="nominatim.display_name as displayName"
                >
                  {{displayName}}
                </div>
                <div class="wm-waypointdetail-item-position" *ngIf="waypoint.geometry as geometry">
                  lat: {{geometry.coordinates[0]}}, lon: {{ geometry.coordinates[1] }}
                </div>
              </div>
            </ion-item>
            <ion-item
              class="wm-waypointdetail-item"
              lines="none"
              *ngIf="rawData.photos != null && rawData.photos.length > 0"
            >
              <i class="webmapp-icon-camera wm-trackdetail-icon secondary" start></i>
              {{'pages.trackdetail.photos'|wmtrans}}
            </ion-item>

            <ng-container *ngIf="rawData.photos != null && rawData.photos.length >0">
              <ion-slides
                pager="false"
                [options]="sliderOptions"
                class="wm-waypointdetail-photoslider"
                #slider
              >
                <ion-slide *ngFor="let photo of rawData.photos;let idx = index">
                  <div class="wm-waypointdetail-photocontainer">
                    <ion-img [src]="photo|wmCreateBlob" class="wm-waypointdetail-photo"></ion-img>
                  </div>
                </ion-slide>
              </ion-slides>
            </ng-container>
          </wm-form>
        </ion-list>
      </ng-container>
    </ng-container>
  </ion-content>
</ng-container>
